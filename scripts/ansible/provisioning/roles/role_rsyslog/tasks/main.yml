- name: Install rsyslog package
  ansible.builtin.package:
    name: rsyslog
    state: present

- name: Copy rsyslog config file
  ansible.builtin.template:
    src: rsyslog_template.j2
    dest: /etc/rsyslog.conf
    mode: '0644'
    owner: root

- name: Start and enable rsyslog service
  ansible.builtin.service:
    name: rsyslog
    state: started
    enabled: true
  notify: Restart rsyslog
  when: ansible_facts.service_mgr == "systemd"

- name: Ensure rsyslog directory exists
  become: true
  ansible.builtin.file:
    path: /var/lib/rsyslog
    state: directory
    mode: '0755'
  when: ansible_facts.service_mgr != "systemd"

- name: Ensure rsyslog is running (non-systemd)
  become: true
  ansible.builtin.command: /usr/sbin/rsyslogd
  when: ansible_facts.service_mgr != "systemd"
  changed_when: true
  register: role_rsyslog_start
  failed_when: false
